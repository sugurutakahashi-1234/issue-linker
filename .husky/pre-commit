# Prevent direct commits to main
[ "$(git branch --show-current)" = "main" ] && echo "❌ No direct commits to main!" && exit 1

# Fix and check code quality
bun run fix
bun run check
git diff --exit-code

# Validate codecov.yml if changed
if git diff --cached --name-only | grep -q "^codecov.yml$"; then
  bun run validate:codecov
fi

# Validate renovate.json5 if changed
if git diff --cached --name-only | grep -q "^renovate.json5$"; then
  bun run validate:renovate
fi

# Auto-update dependency graph
if git diff --cached --name-only | grep -qE "^(packages|src)/.*\.ts$"; then
  bun run docs:update
  
  # Check if any docs were modified
  if ! git diff --exit-code docs/ > /dev/null 2>&1; then
    echo "📊 Documentation has been updated."
    echo "Please review and stage the changes, then commit again:"
    echo "  git diff docs/"
    echo "  git add docs/"
    echo "  git commit"
    exit 1
  fi
fi
